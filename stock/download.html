<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>재고조사 - CSV 다운로드</title>
    <link rel="stylesheet" href="/stock/css/style.css" />
  </head>
  <body>
    <header>
      <div class="container">
        <h1>📦 재고조사 시스템</h1>
        <nav>
          <a href="/stock/index.html">CSV 업로드</a>
          <a href="/stock/inventory.html">재고조사</a>
          <a href="/stock/download.html" class="active">CSV 다운로드</a>
        </nav>
      </div>
    </header>

    <main class="container">
      <div class="card">
        <h2>재고 데이터 다운로드</h2>
        <p class="text-muted mb-3">
          현재 데이터베이스의 모든 제품 정보를 CSV로 다운로드합니다.
        </p>

        <!-- 필터 옵션 -->
        <div class="mb-3">
          <label
            style="
              display: flex;
              align-items: center;
              gap: 8px;
              cursor: pointer;
            "
          >
            <input type="checkbox" id="onlyWithQuantity" style="width: auto" />
            <span>수량이 입력된 제품만 다운로드</span>
          </label>
        </div>

        <!-- 통계 정보 -->
        <div
          id="stats"
          class="mb-3"
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
          "
        >
          <div
            class="card"
            style="
              background: var(--primary-light);
              text-align: center;
              padding: 16px;
            "
          >
            <div
              style="font-size: 2rem; font-weight: 700; color: var(--primary)"
              id="totalCount"
            >
              -
            </div>
            <div style="color: var(--text-secondary); font-size: 0.9rem">
              총 제품 수
            </div>
          </div>
          <div
            class="card"
            style="
              background: hsl(142, 76%, 95%);
              text-align: center;
              padding: 16px;
            "
          >
            <div
              style="font-size: 2rem; font-weight: 700; color: var(--success)"
              id="countedCount"
            >
              -
            </div>
            <div style="color: var(--text-secondary); font-size: 0.9rem">
              재고 입력 완료
            </div>
          </div>
          <div
            class="card"
            style="
              background: hsl(38, 92%, 95%);
              text-align: center;
              padding: 16px;
            "
          >
            <div
              style="font-size: 2rem; font-weight: 700; color: var(--warning)"
              id="progressPercent"
            >
              -
            </div>
            <div style="color: var(--text-secondary); font-size: 0.9rem">
              진행률
            </div>
          </div>
        </div>

        <!-- 다운로드 버튼 -->
        <div style="display: flex; gap: 12px; flex-wrap: wrap">
          <button id="downloadBtn" class="btn btn-success">
            <span>⬇️</span>
            <span>CSV 다운로드</span>
          </button>
          <button id="refreshBtn" class="btn btn-outline">
            <span>🔄</span>
            <span>통계 새로고침</span>
          </button>
        </div>

        <!-- 알림 영역 -->
        <div id="notification" class="hidden mt-2"></div>
      </div>

      <!-- 최근 데이터 미리보기 -->
      <div class="card">
        <h3>📋 데이터 미리보기 (최근 10개)</h3>
        <div id="loadingPreview" class="text-center">
          <div class="spinner"></div>
        </div>
        <div id="previewTable" class="hidden" style="overflow-x: auto">
          <table>
            <thead>
              <tr>
                <th>제품번호</th>
                <th>제품명</th>
                <th>수량</th>
                <th>최종 수정</th>
              </tr>
            </thead>
            <tbody id="previewBody"></tbody>
          </table>
        </div>
      </div>
    </main>

    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- PapaParse for CSV generation -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <!-- Config - Inline -->
    <script>
      const SUPABASE_URL = "https://rgfvubjdjyuitprsagkx.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnZnZ1Ympkanl1aXRwcnNhZ2t4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2NDEzODEsImV4cCI6MjA4NDIxNzM4MX0.yNmb9v4ncLlOaMZ52-yu9EJ3CLV0yI_AGE_m0fX3SOk";
      const supabaseClient = window.supabase.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY
      );
    </script>
    <!-- Download Logic -->
    <script src="/stock/js/download.js"></script>
  </body>
</html>
